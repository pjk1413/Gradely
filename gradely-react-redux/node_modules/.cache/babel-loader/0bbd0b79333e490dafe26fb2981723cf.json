{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n/**\n * Handsontable UndoRedo class\n */\n\n\nimport Hooks from './../../pluginHooks';\nimport { arrayMap, arrayEach } from './../../helpers/array';\nimport { rangeEach } from './../../helpers/number';\nimport { inherit, deepClone } from './../../helpers/object';\nimport { stopImmediatePropagation, isImmediatePropagationStopped } from './../../helpers/dom/event';\nimport { align } from './../contextMenu/utils';\n/**\n * @description\n * Handsontable UndoRedo plugin allows to undo and redo certain actions done in the table.\n *\n * __Note__, that not all actions are currently undo-able. The UndoRedo plugin is enabled by default.\n *\n * @example\n * ```js\n * undo: true\n * ```\n * @class UndoRedo\n * @plugin UndoRedo\n */\n\nfunction UndoRedo(instance) {\n  var plugin = this;\n  this.instance = instance;\n  this.doneActions = [];\n  this.undoneActions = [];\n  this.ignoreNewActions = false;\n  instance.addHook('afterChange', function (changes, source) {\n    var changesLen = changes && changes.length;\n\n    if (!changesLen || ['UndoRedo.undo', 'UndoRedo.redo', 'MergeCells'].includes(source)) {\n      return;\n    }\n\n    var hasDifferences = changes.find(function (change) {\n      var _change = _slicedToArray(change, 4),\n          oldValue = _change[2],\n          newValue = _change[3];\n\n      return oldValue !== newValue;\n    });\n\n    if (!hasDifferences) {\n      return;\n    }\n\n    var clonedChanges = changes.reduce(function (arr, change) {\n      arr.push(_toConsumableArray(change));\n      return arr;\n    }, []);\n    arrayEach(clonedChanges, function (change) {\n      change[1] = instance.propToCol(change[1]);\n    });\n    var selected = changesLen > 1 ? this.getSelected() : [[clonedChanges[0][0], clonedChanges[0][1]]];\n    plugin.done(new UndoRedo.ChangeAction(clonedChanges, selected));\n  });\n  instance.addHook('afterCreateRow', function (index, amount, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.undo' || source === 'auto') {\n      return;\n    }\n\n    var action = new UndoRedo.CreateRowAction(index, amount);\n    plugin.done(action);\n  });\n  instance.addHook('beforeRemoveRow', function (index, amount, logicRows, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto') {\n      return;\n    }\n\n    var originalData = plugin.instance.getSourceDataArray();\n    var rowIndex = (originalData.length + index) % originalData.length;\n    var physicalRowIndex = instance.toPhysicalRow(rowIndex);\n    var removedData = deepClone(originalData.slice(physicalRowIndex, physicalRowIndex + amount));\n    plugin.done(new UndoRedo.RemoveRowAction(rowIndex, removedData));\n  });\n  instance.addHook('afterCreateCol', function (index, amount, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto') {\n      return;\n    }\n\n    plugin.done(new UndoRedo.CreateColumnAction(index, amount));\n  });\n  instance.addHook('beforeRemoveCol', function (index, amount, logicColumns, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto') {\n      return;\n    }\n\n    var originalData = plugin.instance.getSourceDataArray();\n    var columnIndex = (plugin.instance.countCols() + index) % plugin.instance.countCols();\n    var removedData = [];\n    var headers = [];\n    var indexes = [];\n    rangeEach(originalData.length - 1, function (i) {\n      var column = [];\n      var origRow = originalData[i];\n      rangeEach(columnIndex, columnIndex + (amount - 1), function (j) {\n        column.push(origRow[instance.runHooks('modifyCol', j)]);\n      });\n      removedData.push(column);\n    });\n    rangeEach(amount - 1, function (i) {\n      indexes.push(instance.runHooks('modifyCol', columnIndex + i));\n    });\n\n    if (Array.isArray(instance.getSettings().colHeaders)) {\n      rangeEach(amount - 1, function (i) {\n        headers.push(instance.getSettings().colHeaders[instance.runHooks('modifyCol', columnIndex + i)] || null);\n      });\n    }\n\n    var manualColumnMovePlugin = plugin.instance.getPlugin('manualColumnMove');\n    var columnsMap = manualColumnMovePlugin.isEnabled() ? manualColumnMovePlugin.columnsMapper.__arrayMap : [];\n    var action = new UndoRedo.RemoveColumnAction(columnIndex, indexes, removedData, headers, columnsMap);\n    plugin.done(action);\n  });\n  instance.addHook('beforeCellAlignment', function (stateBefore, range, type, alignment) {\n    var action = new UndoRedo.CellAlignmentAction(stateBefore, range, type, alignment);\n    plugin.done(action);\n  });\n  instance.addHook('beforeFilter', function (conditionsStack) {\n    plugin.done(new UndoRedo.FiltersAction(conditionsStack));\n  });\n  instance.addHook('beforeRowMove', function (movedRows, target) {\n    if (movedRows === false) {\n      return;\n    }\n\n    plugin.done(new UndoRedo.RowMoveAction(movedRows, target));\n  });\n  instance.addHook('beforeMergeCells', function (cellRange, auto) {\n    if (auto) {\n      return;\n    }\n\n    plugin.done(new UndoRedo.MergeCellsAction(instance, cellRange));\n  });\n  instance.addHook('afterUnmergeCells', function (cellRange, auto) {\n    if (auto) {\n      return;\n    }\n\n    plugin.done(new UndoRedo.UnmergeCellsAction(instance, cellRange));\n  });\n}\n\nUndoRedo.prototype.done = function (action) {\n  if (!this.ignoreNewActions) {\n    this.doneActions.push(action);\n    this.undoneActions.length = 0;\n  }\n};\n/**\n * Undo the last action performed to the table.\n *\n * @function undo\n * @memberof UndoRedo#\n * @fires Hooks#beforeUndo\n * @fires Hooks#afterUndo\n */\n\n\nUndoRedo.prototype.undo = function () {\n  if (this.isUndoAvailable()) {\n    var action = this.doneActions.pop();\n    var actionClone = deepClone(action);\n    var instance = this.instance;\n    var continueAction = instance.runHooks('beforeUndo', actionClone);\n\n    if (continueAction === false) {\n      return;\n    }\n\n    this.ignoreNewActions = true;\n    var that = this;\n    action.undo(this.instance, function () {\n      that.ignoreNewActions = false;\n      that.undoneActions.push(action);\n    });\n    instance.runHooks('afterUndo', actionClone);\n  }\n};\n/**\n * Redo the previous action performed to the table (used to reverse an undo).\n *\n * @function redo\n * @memberof UndoRedo#\n * @fires Hooks#beforeRedo\n * @fires Hooks#afterRedo\n */\n\n\nUndoRedo.prototype.redo = function () {\n  if (this.isRedoAvailable()) {\n    var action = this.undoneActions.pop();\n    var actionClone = deepClone(action);\n    var instance = this.instance;\n    var continueAction = instance.runHooks('beforeRedo', actionClone);\n\n    if (continueAction === false) {\n      return;\n    }\n\n    this.ignoreNewActions = true;\n    var that = this;\n    action.redo(this.instance, function () {\n      that.ignoreNewActions = false;\n      that.doneActions.push(action);\n    });\n    instance.runHooks('afterRedo', actionClone);\n  }\n};\n/**\n * Checks if undo action is available.\n *\n * @function isUndoAvailable\n * @memberof UndoRedo#\n * @return {Boolean} Return `true` if undo can be performed, `false` otherwise.\n */\n\n\nUndoRedo.prototype.isUndoAvailable = function () {\n  return this.doneActions.length > 0;\n};\n/**\n * Checks if redo action is available.\n *\n * @function isRedoAvailable\n * @memberof UndoRedo#\n * @return {Boolean} Return `true` if redo can be performed, `false` otherwise.\n */\n\n\nUndoRedo.prototype.isRedoAvailable = function () {\n  return this.undoneActions.length > 0;\n};\n/**\n * Clears undo history.\n *\n * @function clear\n * @memberof UndoRedo#\n */\n\n\nUndoRedo.prototype.clear = function () {\n  this.doneActions.length = 0;\n  this.undoneActions.length = 0;\n};\n\nUndoRedo.Action = function () {};\n\nUndoRedo.Action.prototype.undo = function () {};\n\nUndoRedo.Action.prototype.redo = function () {};\n/**\n * Change action.\n *\n * @private\n */\n\n\nUndoRedo.ChangeAction = function (changes, selected) {\n  this.changes = changes;\n  this.selected = selected;\n  this.actionType = 'change';\n};\n\ninherit(UndoRedo.ChangeAction, UndoRedo.Action);\n\nUndoRedo.ChangeAction.prototype.undo = function (instance, undoneCallback) {\n  var data = deepClone(this.changes);\n  var emptyRowsAtTheEnd = instance.countEmptyRows(true);\n  var emptyColsAtTheEnd = instance.countEmptyCols(true);\n\n  for (var i = 0, len = data.length; i < len; i++) {\n    data[i].splice(3, 1);\n  }\n\n  instance.addHookOnce('afterChange', undoneCallback);\n  instance.setDataAtCell(data, null, null, 'UndoRedo.undo');\n\n  for (var _i2 = 0, _len = data.length; _i2 < _len; _i2++) {\n    var _data$_i = _slicedToArray(data[_i2], 2),\n        row = _data$_i[0],\n        column = _data$_i[1];\n\n    if (instance.getSettings().minSpareRows && row + 1 + instance.getSettings().minSpareRows === instance.countRows() && emptyRowsAtTheEnd === instance.getSettings().minSpareRows) {\n      instance.alter('remove_row', parseInt(row + 1, 10), instance.getSettings().minSpareRows);\n      instance.undoRedo.doneActions.pop();\n    }\n\n    if (instance.getSettings().minSpareCols && column + 1 + instance.getSettings().minSpareCols === instance.countCols() && emptyColsAtTheEnd === instance.getSettings().minSpareCols) {\n      instance.alter('remove_col', parseInt(column + 1, 10), instance.getSettings().minSpareCols);\n      instance.undoRedo.doneActions.pop();\n    }\n  }\n\n  instance.selectCells(this.selected, false, false);\n};\n\nUndoRedo.ChangeAction.prototype.redo = function (instance, onFinishCallback) {\n  var data = deepClone(this.changes);\n\n  for (var i = 0, len = data.length; i < len; i++) {\n    data[i].splice(2, 1);\n  }\n\n  instance.addHookOnce('afterChange', onFinishCallback);\n  instance.setDataAtCell(data, null, null, 'UndoRedo.redo');\n\n  if (this.selected) {\n    instance.selectCells(this.selected, false, false);\n  }\n};\n/**\n * Create row action.\n *\n * @private\n */\n\n\nUndoRedo.CreateRowAction = function (index, amount) {\n  this.index = index;\n  this.amount = amount;\n  this.actionType = 'insert_row';\n};\n\ninherit(UndoRedo.CreateRowAction, UndoRedo.Action);\n\nUndoRedo.CreateRowAction.prototype.undo = function (instance, undoneCallback) {\n  var rowCount = instance.countRows();\n  var minSpareRows = instance.getSettings().minSpareRows;\n\n  if (this.index >= rowCount && this.index - minSpareRows < rowCount) {\n    this.index -= minSpareRows; // work around the situation where the needed row was removed due to an 'undo' of a made change\n  }\n\n  instance.addHookOnce('afterRemoveRow', undoneCallback);\n  instance.alter('remove_row', this.index, this.amount, 'UndoRedo.undo');\n};\n\nUndoRedo.CreateRowAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterCreateRow', redoneCallback);\n  instance.alter('insert_row', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\n * Remove row action.\n *\n * @private\n */\n\n\nUndoRedo.RemoveRowAction = function (index, data) {\n  this.index = index;\n  this.data = data;\n  this.actionType = 'remove_row';\n};\n\ninherit(UndoRedo.RemoveRowAction, UndoRedo.Action);\n\nUndoRedo.RemoveRowAction.prototype.undo = function (instance, undoneCallback) {\n  instance.alter('insert_row', this.index, this.data.length, 'UndoRedo.undo');\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.populateFromArray(this.index, 0, this.data, void 0, void 0, 'UndoRedo.undo');\n};\n\nUndoRedo.RemoveRowAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterRemoveRow', redoneCallback);\n  instance.alter('remove_row', this.index, this.data.length, 'UndoRedo.redo');\n};\n/**\n * Create column action.\n *\n * @private\n */\n\n\nUndoRedo.CreateColumnAction = function (index, amount) {\n  this.index = index;\n  this.amount = amount;\n  this.actionType = 'insert_col';\n};\n\ninherit(UndoRedo.CreateColumnAction, UndoRedo.Action);\n\nUndoRedo.CreateColumnAction.prototype.undo = function (instance, undoneCallback) {\n  instance.addHookOnce('afterRemoveCol', undoneCallback);\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.undo');\n};\n\nUndoRedo.CreateColumnAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterCreateCol', redoneCallback);\n  instance.alter('insert_col', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\n * Remove column action.\n *\n * @private\n */\n\n\nUndoRedo.RemoveColumnAction = function (index, indexes, data, headers, columnPositions) {\n  this.index = index;\n  this.indexes = indexes;\n  this.data = data;\n  this.amount = this.data[0].length;\n  this.headers = headers;\n  this.columnPositions = columnPositions.slice(0);\n  this.actionType = 'remove_col';\n};\n\ninherit(UndoRedo.RemoveColumnAction, UndoRedo.Action);\n\nUndoRedo.RemoveColumnAction.prototype.undo = function (instance, undoneCallback) {\n  var _this = this;\n\n  var row;\n  var ascendingIndexes = this.indexes.slice(0).sort();\n\n  var sortByIndexes = function sortByIndexes(elem, j, arr) {\n    return arr[_this.indexes.indexOf(ascendingIndexes[j])];\n  };\n\n  var sortedData = [];\n  rangeEach(this.data.length - 1, function (i) {\n    sortedData[i] = arrayMap(_this.data[i], sortByIndexes);\n  });\n  var sortedHeaders = [];\n  sortedHeaders = arrayMap(this.headers, sortByIndexes);\n  var changes = []; // TODO: Temporary hook for undo/redo mess\n\n  instance.runHooks('beforeCreateCol', this.indexes[0], this.indexes.length, 'UndoRedo.undo');\n  rangeEach(this.data.length - 1, function (i) {\n    row = instance.getSourceDataAtRow(i);\n    rangeEach(ascendingIndexes.length - 1, function (j) {\n      row.splice(ascendingIndexes[j], 0, sortedData[i][j]);\n      changes.push([i, ascendingIndexes[j], null, sortedData[i][j]]);\n    });\n  }); // TODO: Temporary hook for undo/redo mess\n\n  if (instance.getPlugin('formulas')) {\n    instance.getPlugin('formulas').onAfterSetDataAtCell(changes);\n  }\n\n  if (typeof this.headers !== 'undefined') {\n    rangeEach(sortedHeaders.length - 1, function (j) {\n      instance.getSettings().colHeaders.splice(ascendingIndexes[j], 0, sortedHeaders[j]);\n    });\n  }\n\n  if (instance.getPlugin('manualColumnMove')) {\n    instance.getPlugin('manualColumnMove').columnsMapper.__arrayMap = this.columnPositions;\n  }\n\n  instance.addHookOnce('afterRender', undoneCallback); // TODO: Temporary hook for undo/redo mess\n\n  instance.runHooks('afterCreateCol', this.indexes[0], this.indexes.length, 'UndoRedo.undo');\n\n  if (instance.getPlugin('formulas')) {\n    instance.getPlugin('formulas').recalculateFull();\n  }\n\n  instance.render();\n};\n\nUndoRedo.RemoveColumnAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterRemoveCol', redoneCallback);\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\n * Cell alignment action.\n *\n * @private\n */\n\n\nUndoRedo.CellAlignmentAction = function (stateBefore, range, type, alignment) {\n  this.stateBefore = stateBefore;\n  this.range = range;\n  this.type = type;\n  this.alignment = alignment;\n};\n\nUndoRedo.CellAlignmentAction.prototype.undo = function (instance, undoneCallback) {\n  var _this2 = this;\n\n  arrayEach(this.range, function (_ref) {\n    var from = _ref.from,\n        to = _ref.to;\n\n    for (var row = from.row; row <= to.row; row += 1) {\n      for (var col = from.col; col <= to.col; col += 1) {\n        instance.setCellMeta(row, col, 'className', _this2.stateBefore[row][col] || ' htLeft');\n      }\n    }\n  });\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n\nUndoRedo.CellAlignmentAction.prototype.redo = function (instance, undoneCallback) {\n  align(this.range, this.type, this.alignment, function (row, col) {\n    return instance.getCellMeta(row, col);\n  }, function (row, col, key, value) {\n    return instance.setCellMeta(row, col, key, value);\n  });\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n/**\n * Filters action.\n *\n * @private\n */\n\n\nUndoRedo.FiltersAction = function (conditionsStack) {\n  this.conditionsStack = conditionsStack;\n  this.actionType = 'filter';\n};\n\ninherit(UndoRedo.FiltersAction, UndoRedo.Action);\n\nUndoRedo.FiltersAction.prototype.undo = function (instance, undoneCallback) {\n  var filters = instance.getPlugin('filters');\n  instance.addHookOnce('afterRender', undoneCallback);\n  filters.conditionCollection.importAllConditions(this.conditionsStack.slice(0, this.conditionsStack.length - 1));\n  filters.filter();\n};\n\nUndoRedo.FiltersAction.prototype.redo = function (instance, redoneCallback) {\n  var filters = instance.getPlugin('filters');\n  instance.addHookOnce('afterRender', redoneCallback);\n  filters.conditionCollection.importAllConditions(this.conditionsStack);\n  filters.filter();\n};\n/**\n * Merge Cells action.\n * @util\n */\n\n\nvar MergeCellsAction = /*#__PURE__*/function (_UndoRedo$Action) {\n  _inherits(MergeCellsAction, _UndoRedo$Action);\n\n  function MergeCellsAction(instance, cellRange) {\n    var _this3;\n\n    _classCallCheck(this, MergeCellsAction);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(MergeCellsAction).call(this));\n    _this3.cellRange = cellRange;\n    _this3.rangeData = instance.getData(cellRange.from.row, cellRange.from.col, cellRange.to.row, cellRange.to.col);\n    return _this3;\n  }\n\n  _createClass(MergeCellsAction, [{\n    key: \"undo\",\n    value: function undo(instance, undoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', undoneCallback);\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\n      instance.populateFromArray(this.cellRange.from.row, this.cellRange.from.col, this.rangeData, void 0, void 0, 'MergeCells');\n    }\n  }, {\n    key: \"redo\",\n    value: function redo(instance, redoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', redoneCallback);\n      mergeCellsPlugin.mergeRange(this.cellRange);\n    }\n  }]);\n\n  return MergeCellsAction;\n}(UndoRedo.Action);\n\nUndoRedo.MergeCellsAction = MergeCellsAction;\n/**\n * Unmerge Cells action.\n * @util\n */\n\nvar UnmergeCellsAction = /*#__PURE__*/function (_UndoRedo$Action2) {\n  _inherits(UnmergeCellsAction, _UndoRedo$Action2);\n\n  function UnmergeCellsAction(instance, cellRange) {\n    var _this4;\n\n    _classCallCheck(this, UnmergeCellsAction);\n\n    _this4 = _possibleConstructorReturn(this, _getPrototypeOf(UnmergeCellsAction).call(this));\n    _this4.cellRange = cellRange;\n    return _this4;\n  }\n\n  _createClass(UnmergeCellsAction, [{\n    key: \"undo\",\n    value: function undo(instance, undoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', undoneCallback);\n      mergeCellsPlugin.mergeRange(this.cellRange, true);\n    }\n  }, {\n    key: \"redo\",\n    value: function redo(instance, redoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', redoneCallback);\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\n      instance.render();\n    }\n  }]);\n\n  return UnmergeCellsAction;\n}(UndoRedo.Action);\n\nUndoRedo.UnmergeCellsAction = UnmergeCellsAction;\n/**\n * ManualRowMove action.\n *\n * @private\n * @TODO: removeRow undo should works on logical index\n */\n\nUndoRedo.RowMoveAction = function (movedRows, target) {\n  this.rows = movedRows.slice();\n  this.target = target;\n};\n\ninherit(UndoRedo.RowMoveAction, UndoRedo.Action);\n\nUndoRedo.RowMoveAction.prototype.undo = function (instance, undoneCallback) {\n  var manualRowMove = instance.getPlugin('manualRowMove');\n  instance.addHookOnce('afterRender', undoneCallback);\n  var mod = this.rows[0] < this.target ? -1 * this.rows.length : 0;\n  var newTarget = this.rows[0] > this.target ? this.rows[0] + this.rows.length : this.rows[0];\n  var newRows = [];\n  var rowsLen = this.rows.length + mod;\n\n  for (var i = mod; i < rowsLen; i += 1) {\n    newRows.push(this.target + i);\n  }\n\n  manualRowMove.moveRows(newRows.slice(), newTarget);\n  instance.render();\n  instance.selectCell(this.rows[0], 0, this.rows[this.rows.length - 1], instance.countCols() - 1, false, false);\n};\n\nUndoRedo.RowMoveAction.prototype.redo = function (instance, redoneCallback) {\n  var manualRowMove = instance.getPlugin('manualRowMove');\n  instance.addHookOnce('afterRender', redoneCallback);\n  manualRowMove.moveRows(this.rows.slice(), this.target);\n  instance.render();\n  var startSelection = this.rows[0] < this.target ? this.target - this.rows.length : this.target;\n  instance.selectCell(startSelection, 0, startSelection + this.rows.length - 1, instance.countCols() - 1, false, false);\n};\n\nfunction init() {\n  var instance = this;\n  var pluginEnabled = typeof instance.getSettings().undo === 'undefined' || instance.getSettings().undo;\n\n  if (pluginEnabled) {\n    if (!instance.undoRedo) {\n      /**\n       * Instance of Handsontable.UndoRedo Plugin {@link Handsontable.UndoRedo}\n       *\n       * @alias undoRedo\n       * @memberof! Handsontable.Core#\n       * @type {UndoRedo}\n       */\n      instance.undoRedo = new UndoRedo(instance);\n      exposeUndoRedoMethods(instance);\n      instance.addHook('beforeKeyDown', onBeforeKeyDown);\n      instance.addHook('afterChange', onAfterChange);\n    }\n  } else if (instance.undoRedo) {\n    delete instance.undoRedo;\n    removeExposedUndoRedoMethods(instance);\n    instance.removeHook('beforeKeyDown', onBeforeKeyDown);\n    instance.removeHook('afterChange', onAfterChange);\n  }\n}\n\nfunction onBeforeKeyDown(event) {\n  if (isImmediatePropagationStopped(event)) {\n    return;\n  }\n\n  var instance = this;\n  var editor = instance.getActiveEditor();\n\n  if (editor && editor.isOpened()) {\n    return;\n  }\n\n  var altKey = event.altKey,\n      ctrlKey = event.ctrlKey,\n      keyCode = event.keyCode,\n      metaKey = event.metaKey,\n      shiftKey = event.shiftKey;\n  var isCtrlDown = (ctrlKey || metaKey) && !altKey;\n\n  if (!isCtrlDown) {\n    return;\n  }\n\n  var isRedoHotkey = keyCode === 89 || shiftKey && keyCode === 90;\n\n  if (isRedoHotkey) {\n    // CTRL + Y or CTRL + SHIFT + Z\n    instance.undoRedo.redo();\n    stopImmediatePropagation(event);\n  } else if (keyCode === 90) {\n    // CTRL + Z\n    instance.undoRedo.undo();\n    stopImmediatePropagation(event);\n  }\n}\n\nfunction onAfterChange(changes, source) {\n  var instance = this;\n\n  if (source === 'loadData') {\n    return instance.undoRedo.clear();\n  }\n}\n\nfunction exposeUndoRedoMethods(instance) {\n  /**\n   * {@link UndoRedo#undo}\n   * @alias undo\n   * @memberof! Handsontable.Core#\n   */\n  instance.undo = function () {\n    return instance.undoRedo.undo();\n  };\n  /**\n   * {@link UndoRedo#redo}\n   * @alias redo\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.redo = function () {\n    return instance.undoRedo.redo();\n  };\n  /**\n   * {@link UndoRedo#isUndoAvailable}\n   * @alias isUndoAvailable\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.isUndoAvailable = function () {\n    return instance.undoRedo.isUndoAvailable();\n  };\n  /**\n   * {@link UndoRedo#isRedoAvailable}\n   * @alias isRedoAvailable\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.isRedoAvailable = function () {\n    return instance.undoRedo.isRedoAvailable();\n  };\n  /**\n   * {@link UndoRedo#clear}\n   * @alias clearUndo\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.clearUndo = function () {\n    return instance.undoRedo.clear();\n  };\n}\n\nfunction removeExposedUndoRedoMethods(instance) {\n  delete instance.undo;\n  delete instance.redo;\n  delete instance.isUndoAvailable;\n  delete instance.isRedoAvailable;\n  delete instance.clearUndo;\n}\n\nvar hook = Hooks.getSingleton();\nhook.add('afterInit', init);\nhook.add('afterUpdateSettings', init);\nhook.register('beforeUndo');\nhook.register('afterUndo');\nhook.register('beforeRedo');\nhook.register('afterRedo');\nexport default UndoRedo;","map":{"version":3,"sources":["C:/Users/pjk14/Desktop/Gradely/gradely-react-redux/node_modules/handsontable/es/plugins/undoRedo/undoRedo.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_inherits","subClass","superClass","create","value","_setPrototypeOf","p","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","toString","Array","from","isArray","arr2","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","err","Hooks","arrayMap","arrayEach","rangeEach","inherit","deepClone","stopImmediatePropagation","isImmediatePropagationStopped","align","UndoRedo","plugin","doneActions","undoneActions","ignoreNewActions","addHook","changes","source","changesLen","includes","hasDifferences","find","change","_change","oldValue","newValue","clonedChanges","reduce","propToCol","selected","getSelected","ChangeAction","index","amount","action","CreateRowAction","logicRows","originalData","getSourceDataArray","rowIndex","physicalRowIndex","toPhysicalRow","removedData","slice","RemoveRowAction","CreateColumnAction","logicColumns","columnIndex","countCols","headers","indexes","column","origRow","j","runHooks","getSettings","colHeaders","manualColumnMovePlugin","getPlugin","columnsMap","isEnabled","columnsMapper","__arrayMap","RemoveColumnAction","stateBefore","range","type","alignment","CellAlignmentAction","conditionsStack","FiltersAction","movedRows","RowMoveAction","cellRange","auto","MergeCellsAction","UnmergeCellsAction","undo","isUndoAvailable","pop","actionClone","continueAction","that","redo","isRedoAvailable","clear","Action","actionType","undoneCallback","data","emptyRowsAtTheEnd","countEmptyRows","emptyColsAtTheEnd","countEmptyCols","len","splice","addHookOnce","setDataAtCell","_i2","_len","_data$_i","row","minSpareRows","countRows","alter","parseInt","undoRedo","minSpareCols","selectCells","onFinishCallback","rowCount","redoneCallback","populateFromArray","columnPositions","_this","ascendingIndexes","sort","sortByIndexes","elem","indexOf","sortedData","sortedHeaders","getSourceDataAtRow","onAfterSetDataAtCell","recalculateFull","render","_this2","_ref","to","col","setCellMeta","getCellMeta","filters","conditionCollection","importAllConditions","filter","_UndoRedo$Action","_this3","rangeData","getData","mergeCellsPlugin","unmergeRange","mergeRange","_UndoRedo$Action2","_this4","rows","manualRowMove","mod","newTarget","newRows","rowsLen","moveRows","selectCell","startSelection","init","pluginEnabled","exposeUndoRedoMethods","onBeforeKeyDown","onAfterChange","removeExposedUndoRedoMethods","removeHook","event","editor","getActiveEditor","isOpened","altKey","ctrlKey","keyCode","metaKey","shiftKey","isCtrlDown","isRedoHotkey","clearUndo","hook","getSingleton","add","register"],"mappings":"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","sourcesContent":["import \"core-js/modules/es.symbol\";\nimport \"core-js/modules/es.symbol.description\";\nimport \"core-js/modules/es.symbol.iterator\";\nimport \"core-js/modules/es.array.filter\";\nimport \"core-js/modules/es.array.find\";\nimport \"core-js/modules/es.array.from\";\nimport \"core-js/modules/es.array.includes\";\nimport \"core-js/modules/es.array.index-of\";\nimport \"core-js/modules/es.array.iterator\";\nimport \"core-js/modules/es.array.reduce\";\nimport \"core-js/modules/es.array.slice\";\nimport \"core-js/modules/es.array.sort\";\nimport \"core-js/modules/es.array.splice\";\nimport \"core-js/modules/es.object.get-prototype-of\";\nimport \"core-js/modules/es.object.set-prototype-of\";\nimport \"core-js/modules/es.object.to-string\";\nimport \"core-js/modules/es.regexp.to-string\";\nimport \"core-js/modules/es.string.iterator\";\nimport \"core-js/modules/web.dom-collections.iterator\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n/**\n * Handsontable UndoRedo class\n */\nimport Hooks from './../../pluginHooks';\nimport { arrayMap, arrayEach } from './../../helpers/array';\nimport { rangeEach } from './../../helpers/number';\nimport { inherit, deepClone } from './../../helpers/object';\nimport { stopImmediatePropagation, isImmediatePropagationStopped } from './../../helpers/dom/event';\nimport { align } from './../contextMenu/utils';\n/**\n * @description\n * Handsontable UndoRedo plugin allows to undo and redo certain actions done in the table.\n *\n * __Note__, that not all actions are currently undo-able. The UndoRedo plugin is enabled by default.\n *\n * @example\n * ```js\n * undo: true\n * ```\n * @class UndoRedo\n * @plugin UndoRedo\n */\n\nfunction UndoRedo(instance) {\n  var plugin = this;\n  this.instance = instance;\n  this.doneActions = [];\n  this.undoneActions = [];\n  this.ignoreNewActions = false;\n  instance.addHook('afterChange', function (changes, source) {\n    var changesLen = changes && changes.length;\n\n    if (!changesLen || ['UndoRedo.undo', 'UndoRedo.redo', 'MergeCells'].includes(source)) {\n      return;\n    }\n\n    var hasDifferences = changes.find(function (change) {\n      var _change = _slicedToArray(change, 4),\n          oldValue = _change[2],\n          newValue = _change[3];\n\n      return oldValue !== newValue;\n    });\n\n    if (!hasDifferences) {\n      return;\n    }\n\n    var clonedChanges = changes.reduce(function (arr, change) {\n      arr.push(_toConsumableArray(change));\n      return arr;\n    }, []);\n    arrayEach(clonedChanges, function (change) {\n      change[1] = instance.propToCol(change[1]);\n    });\n    var selected = changesLen > 1 ? this.getSelected() : [[clonedChanges[0][0], clonedChanges[0][1]]];\n    plugin.done(new UndoRedo.ChangeAction(clonedChanges, selected));\n  });\n  instance.addHook('afterCreateRow', function (index, amount, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.undo' || source === 'auto') {\n      return;\n    }\n\n    var action = new UndoRedo.CreateRowAction(index, amount);\n    plugin.done(action);\n  });\n  instance.addHook('beforeRemoveRow', function (index, amount, logicRows, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto') {\n      return;\n    }\n\n    var originalData = plugin.instance.getSourceDataArray();\n    var rowIndex = (originalData.length + index) % originalData.length;\n    var physicalRowIndex = instance.toPhysicalRow(rowIndex);\n    var removedData = deepClone(originalData.slice(physicalRowIndex, physicalRowIndex + amount));\n    plugin.done(new UndoRedo.RemoveRowAction(rowIndex, removedData));\n  });\n  instance.addHook('afterCreateCol', function (index, amount, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto') {\n      return;\n    }\n\n    plugin.done(new UndoRedo.CreateColumnAction(index, amount));\n  });\n  instance.addHook('beforeRemoveCol', function (index, amount, logicColumns, source) {\n    if (source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto') {\n      return;\n    }\n\n    var originalData = plugin.instance.getSourceDataArray();\n    var columnIndex = (plugin.instance.countCols() + index) % plugin.instance.countCols();\n    var removedData = [];\n    var headers = [];\n    var indexes = [];\n    rangeEach(originalData.length - 1, function (i) {\n      var column = [];\n      var origRow = originalData[i];\n      rangeEach(columnIndex, columnIndex + (amount - 1), function (j) {\n        column.push(origRow[instance.runHooks('modifyCol', j)]);\n      });\n      removedData.push(column);\n    });\n    rangeEach(amount - 1, function (i) {\n      indexes.push(instance.runHooks('modifyCol', columnIndex + i));\n    });\n\n    if (Array.isArray(instance.getSettings().colHeaders)) {\n      rangeEach(amount - 1, function (i) {\n        headers.push(instance.getSettings().colHeaders[instance.runHooks('modifyCol', columnIndex + i)] || null);\n      });\n    }\n\n    var manualColumnMovePlugin = plugin.instance.getPlugin('manualColumnMove');\n    var columnsMap = manualColumnMovePlugin.isEnabled() ? manualColumnMovePlugin.columnsMapper.__arrayMap : [];\n    var action = new UndoRedo.RemoveColumnAction(columnIndex, indexes, removedData, headers, columnsMap);\n    plugin.done(action);\n  });\n  instance.addHook('beforeCellAlignment', function (stateBefore, range, type, alignment) {\n    var action = new UndoRedo.CellAlignmentAction(stateBefore, range, type, alignment);\n    plugin.done(action);\n  });\n  instance.addHook('beforeFilter', function (conditionsStack) {\n    plugin.done(new UndoRedo.FiltersAction(conditionsStack));\n  });\n  instance.addHook('beforeRowMove', function (movedRows, target) {\n    if (movedRows === false) {\n      return;\n    }\n\n    plugin.done(new UndoRedo.RowMoveAction(movedRows, target));\n  });\n  instance.addHook('beforeMergeCells', function (cellRange, auto) {\n    if (auto) {\n      return;\n    }\n\n    plugin.done(new UndoRedo.MergeCellsAction(instance, cellRange));\n  });\n  instance.addHook('afterUnmergeCells', function (cellRange, auto) {\n    if (auto) {\n      return;\n    }\n\n    plugin.done(new UndoRedo.UnmergeCellsAction(instance, cellRange));\n  });\n}\n\nUndoRedo.prototype.done = function (action) {\n  if (!this.ignoreNewActions) {\n    this.doneActions.push(action);\n    this.undoneActions.length = 0;\n  }\n};\n/**\n * Undo the last action performed to the table.\n *\n * @function undo\n * @memberof UndoRedo#\n * @fires Hooks#beforeUndo\n * @fires Hooks#afterUndo\n */\n\n\nUndoRedo.prototype.undo = function () {\n  if (this.isUndoAvailable()) {\n    var action = this.doneActions.pop();\n    var actionClone = deepClone(action);\n    var instance = this.instance;\n    var continueAction = instance.runHooks('beforeUndo', actionClone);\n\n    if (continueAction === false) {\n      return;\n    }\n\n    this.ignoreNewActions = true;\n    var that = this;\n    action.undo(this.instance, function () {\n      that.ignoreNewActions = false;\n      that.undoneActions.push(action);\n    });\n    instance.runHooks('afterUndo', actionClone);\n  }\n};\n/**\n * Redo the previous action performed to the table (used to reverse an undo).\n *\n * @function redo\n * @memberof UndoRedo#\n * @fires Hooks#beforeRedo\n * @fires Hooks#afterRedo\n */\n\n\nUndoRedo.prototype.redo = function () {\n  if (this.isRedoAvailable()) {\n    var action = this.undoneActions.pop();\n    var actionClone = deepClone(action);\n    var instance = this.instance;\n    var continueAction = instance.runHooks('beforeRedo', actionClone);\n\n    if (continueAction === false) {\n      return;\n    }\n\n    this.ignoreNewActions = true;\n    var that = this;\n    action.redo(this.instance, function () {\n      that.ignoreNewActions = false;\n      that.doneActions.push(action);\n    });\n    instance.runHooks('afterRedo', actionClone);\n  }\n};\n/**\n * Checks if undo action is available.\n *\n * @function isUndoAvailable\n * @memberof UndoRedo#\n * @return {Boolean} Return `true` if undo can be performed, `false` otherwise.\n */\n\n\nUndoRedo.prototype.isUndoAvailable = function () {\n  return this.doneActions.length > 0;\n};\n/**\n * Checks if redo action is available.\n *\n * @function isRedoAvailable\n * @memberof UndoRedo#\n * @return {Boolean} Return `true` if redo can be performed, `false` otherwise.\n */\n\n\nUndoRedo.prototype.isRedoAvailable = function () {\n  return this.undoneActions.length > 0;\n};\n/**\n * Clears undo history.\n *\n * @function clear\n * @memberof UndoRedo#\n */\n\n\nUndoRedo.prototype.clear = function () {\n  this.doneActions.length = 0;\n  this.undoneActions.length = 0;\n};\n\nUndoRedo.Action = function () {};\n\nUndoRedo.Action.prototype.undo = function () {};\n\nUndoRedo.Action.prototype.redo = function () {};\n/**\n * Change action.\n *\n * @private\n */\n\n\nUndoRedo.ChangeAction = function (changes, selected) {\n  this.changes = changes;\n  this.selected = selected;\n  this.actionType = 'change';\n};\n\ninherit(UndoRedo.ChangeAction, UndoRedo.Action);\n\nUndoRedo.ChangeAction.prototype.undo = function (instance, undoneCallback) {\n  var data = deepClone(this.changes);\n  var emptyRowsAtTheEnd = instance.countEmptyRows(true);\n  var emptyColsAtTheEnd = instance.countEmptyCols(true);\n\n  for (var i = 0, len = data.length; i < len; i++) {\n    data[i].splice(3, 1);\n  }\n\n  instance.addHookOnce('afterChange', undoneCallback);\n  instance.setDataAtCell(data, null, null, 'UndoRedo.undo');\n\n  for (var _i2 = 0, _len = data.length; _i2 < _len; _i2++) {\n    var _data$_i = _slicedToArray(data[_i2], 2),\n        row = _data$_i[0],\n        column = _data$_i[1];\n\n    if (instance.getSettings().minSpareRows && row + 1 + instance.getSettings().minSpareRows === instance.countRows() && emptyRowsAtTheEnd === instance.getSettings().minSpareRows) {\n      instance.alter('remove_row', parseInt(row + 1, 10), instance.getSettings().minSpareRows);\n      instance.undoRedo.doneActions.pop();\n    }\n\n    if (instance.getSettings().minSpareCols && column + 1 + instance.getSettings().minSpareCols === instance.countCols() && emptyColsAtTheEnd === instance.getSettings().minSpareCols) {\n      instance.alter('remove_col', parseInt(column + 1, 10), instance.getSettings().minSpareCols);\n      instance.undoRedo.doneActions.pop();\n    }\n  }\n\n  instance.selectCells(this.selected, false, false);\n};\n\nUndoRedo.ChangeAction.prototype.redo = function (instance, onFinishCallback) {\n  var data = deepClone(this.changes);\n\n  for (var i = 0, len = data.length; i < len; i++) {\n    data[i].splice(2, 1);\n  }\n\n  instance.addHookOnce('afterChange', onFinishCallback);\n  instance.setDataAtCell(data, null, null, 'UndoRedo.redo');\n\n  if (this.selected) {\n    instance.selectCells(this.selected, false, false);\n  }\n};\n/**\n * Create row action.\n *\n * @private\n */\n\n\nUndoRedo.CreateRowAction = function (index, amount) {\n  this.index = index;\n  this.amount = amount;\n  this.actionType = 'insert_row';\n};\n\ninherit(UndoRedo.CreateRowAction, UndoRedo.Action);\n\nUndoRedo.CreateRowAction.prototype.undo = function (instance, undoneCallback) {\n  var rowCount = instance.countRows();\n  var minSpareRows = instance.getSettings().minSpareRows;\n\n  if (this.index >= rowCount && this.index - minSpareRows < rowCount) {\n    this.index -= minSpareRows; // work around the situation where the needed row was removed due to an 'undo' of a made change\n  }\n\n  instance.addHookOnce('afterRemoveRow', undoneCallback);\n  instance.alter('remove_row', this.index, this.amount, 'UndoRedo.undo');\n};\n\nUndoRedo.CreateRowAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterCreateRow', redoneCallback);\n  instance.alter('insert_row', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\n * Remove row action.\n *\n * @private\n */\n\n\nUndoRedo.RemoveRowAction = function (index, data) {\n  this.index = index;\n  this.data = data;\n  this.actionType = 'remove_row';\n};\n\ninherit(UndoRedo.RemoveRowAction, UndoRedo.Action);\n\nUndoRedo.RemoveRowAction.prototype.undo = function (instance, undoneCallback) {\n  instance.alter('insert_row', this.index, this.data.length, 'UndoRedo.undo');\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.populateFromArray(this.index, 0, this.data, void 0, void 0, 'UndoRedo.undo');\n};\n\nUndoRedo.RemoveRowAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterRemoveRow', redoneCallback);\n  instance.alter('remove_row', this.index, this.data.length, 'UndoRedo.redo');\n};\n/**\n * Create column action.\n *\n * @private\n */\n\n\nUndoRedo.CreateColumnAction = function (index, amount) {\n  this.index = index;\n  this.amount = amount;\n  this.actionType = 'insert_col';\n};\n\ninherit(UndoRedo.CreateColumnAction, UndoRedo.Action);\n\nUndoRedo.CreateColumnAction.prototype.undo = function (instance, undoneCallback) {\n  instance.addHookOnce('afterRemoveCol', undoneCallback);\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.undo');\n};\n\nUndoRedo.CreateColumnAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterCreateCol', redoneCallback);\n  instance.alter('insert_col', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\n * Remove column action.\n *\n * @private\n */\n\n\nUndoRedo.RemoveColumnAction = function (index, indexes, data, headers, columnPositions) {\n  this.index = index;\n  this.indexes = indexes;\n  this.data = data;\n  this.amount = this.data[0].length;\n  this.headers = headers;\n  this.columnPositions = columnPositions.slice(0);\n  this.actionType = 'remove_col';\n};\n\ninherit(UndoRedo.RemoveColumnAction, UndoRedo.Action);\n\nUndoRedo.RemoveColumnAction.prototype.undo = function (instance, undoneCallback) {\n  var _this = this;\n\n  var row;\n  var ascendingIndexes = this.indexes.slice(0).sort();\n\n  var sortByIndexes = function sortByIndexes(elem, j, arr) {\n    return arr[_this.indexes.indexOf(ascendingIndexes[j])];\n  };\n\n  var sortedData = [];\n  rangeEach(this.data.length - 1, function (i) {\n    sortedData[i] = arrayMap(_this.data[i], sortByIndexes);\n  });\n  var sortedHeaders = [];\n  sortedHeaders = arrayMap(this.headers, sortByIndexes);\n  var changes = []; // TODO: Temporary hook for undo/redo mess\n\n  instance.runHooks('beforeCreateCol', this.indexes[0], this.indexes.length, 'UndoRedo.undo');\n  rangeEach(this.data.length - 1, function (i) {\n    row = instance.getSourceDataAtRow(i);\n    rangeEach(ascendingIndexes.length - 1, function (j) {\n      row.splice(ascendingIndexes[j], 0, sortedData[i][j]);\n      changes.push([i, ascendingIndexes[j], null, sortedData[i][j]]);\n    });\n  }); // TODO: Temporary hook for undo/redo mess\n\n  if (instance.getPlugin('formulas')) {\n    instance.getPlugin('formulas').onAfterSetDataAtCell(changes);\n  }\n\n  if (typeof this.headers !== 'undefined') {\n    rangeEach(sortedHeaders.length - 1, function (j) {\n      instance.getSettings().colHeaders.splice(ascendingIndexes[j], 0, sortedHeaders[j]);\n    });\n  }\n\n  if (instance.getPlugin('manualColumnMove')) {\n    instance.getPlugin('manualColumnMove').columnsMapper.__arrayMap = this.columnPositions;\n  }\n\n  instance.addHookOnce('afterRender', undoneCallback); // TODO: Temporary hook for undo/redo mess\n\n  instance.runHooks('afterCreateCol', this.indexes[0], this.indexes.length, 'UndoRedo.undo');\n\n  if (instance.getPlugin('formulas')) {\n    instance.getPlugin('formulas').recalculateFull();\n  }\n\n  instance.render();\n};\n\nUndoRedo.RemoveColumnAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterRemoveCol', redoneCallback);\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\n * Cell alignment action.\n *\n * @private\n */\n\n\nUndoRedo.CellAlignmentAction = function (stateBefore, range, type, alignment) {\n  this.stateBefore = stateBefore;\n  this.range = range;\n  this.type = type;\n  this.alignment = alignment;\n};\n\nUndoRedo.CellAlignmentAction.prototype.undo = function (instance, undoneCallback) {\n  var _this2 = this;\n\n  arrayEach(this.range, function (_ref) {\n    var from = _ref.from,\n        to = _ref.to;\n\n    for (var row = from.row; row <= to.row; row += 1) {\n      for (var col = from.col; col <= to.col; col += 1) {\n        instance.setCellMeta(row, col, 'className', _this2.stateBefore[row][col] || ' htLeft');\n      }\n    }\n  });\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n\nUndoRedo.CellAlignmentAction.prototype.redo = function (instance, undoneCallback) {\n  align(this.range, this.type, this.alignment, function (row, col) {\n    return instance.getCellMeta(row, col);\n  }, function (row, col, key, value) {\n    return instance.setCellMeta(row, col, key, value);\n  });\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n/**\n * Filters action.\n *\n * @private\n */\n\n\nUndoRedo.FiltersAction = function (conditionsStack) {\n  this.conditionsStack = conditionsStack;\n  this.actionType = 'filter';\n};\n\ninherit(UndoRedo.FiltersAction, UndoRedo.Action);\n\nUndoRedo.FiltersAction.prototype.undo = function (instance, undoneCallback) {\n  var filters = instance.getPlugin('filters');\n  instance.addHookOnce('afterRender', undoneCallback);\n  filters.conditionCollection.importAllConditions(this.conditionsStack.slice(0, this.conditionsStack.length - 1));\n  filters.filter();\n};\n\nUndoRedo.FiltersAction.prototype.redo = function (instance, redoneCallback) {\n  var filters = instance.getPlugin('filters');\n  instance.addHookOnce('afterRender', redoneCallback);\n  filters.conditionCollection.importAllConditions(this.conditionsStack);\n  filters.filter();\n};\n/**\n * Merge Cells action.\n * @util\n */\n\n\nvar MergeCellsAction =\n/*#__PURE__*/\nfunction (_UndoRedo$Action) {\n  _inherits(MergeCellsAction, _UndoRedo$Action);\n\n  function MergeCellsAction(instance, cellRange) {\n    var _this3;\n\n    _classCallCheck(this, MergeCellsAction);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(MergeCellsAction).call(this));\n    _this3.cellRange = cellRange;\n    _this3.rangeData = instance.getData(cellRange.from.row, cellRange.from.col, cellRange.to.row, cellRange.to.col);\n    return _this3;\n  }\n\n  _createClass(MergeCellsAction, [{\n    key: \"undo\",\n    value: function undo(instance, undoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', undoneCallback);\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\n      instance.populateFromArray(this.cellRange.from.row, this.cellRange.from.col, this.rangeData, void 0, void 0, 'MergeCells');\n    }\n  }, {\n    key: \"redo\",\n    value: function redo(instance, redoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', redoneCallback);\n      mergeCellsPlugin.mergeRange(this.cellRange);\n    }\n  }]);\n\n  return MergeCellsAction;\n}(UndoRedo.Action);\n\nUndoRedo.MergeCellsAction = MergeCellsAction;\n/**\n * Unmerge Cells action.\n * @util\n */\n\nvar UnmergeCellsAction =\n/*#__PURE__*/\nfunction (_UndoRedo$Action2) {\n  _inherits(UnmergeCellsAction, _UndoRedo$Action2);\n\n  function UnmergeCellsAction(instance, cellRange) {\n    var _this4;\n\n    _classCallCheck(this, UnmergeCellsAction);\n\n    _this4 = _possibleConstructorReturn(this, _getPrototypeOf(UnmergeCellsAction).call(this));\n    _this4.cellRange = cellRange;\n    return _this4;\n  }\n\n  _createClass(UnmergeCellsAction, [{\n    key: \"undo\",\n    value: function undo(instance, undoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', undoneCallback);\n      mergeCellsPlugin.mergeRange(this.cellRange, true);\n    }\n  }, {\n    key: \"redo\",\n    value: function redo(instance, redoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', redoneCallback);\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\n      instance.render();\n    }\n  }]);\n\n  return UnmergeCellsAction;\n}(UndoRedo.Action);\n\nUndoRedo.UnmergeCellsAction = UnmergeCellsAction;\n/**\n * ManualRowMove action.\n *\n * @private\n * @TODO: removeRow undo should works on logical index\n */\n\nUndoRedo.RowMoveAction = function (movedRows, target) {\n  this.rows = movedRows.slice();\n  this.target = target;\n};\n\ninherit(UndoRedo.RowMoveAction, UndoRedo.Action);\n\nUndoRedo.RowMoveAction.prototype.undo = function (instance, undoneCallback) {\n  var manualRowMove = instance.getPlugin('manualRowMove');\n  instance.addHookOnce('afterRender', undoneCallback);\n  var mod = this.rows[0] < this.target ? -1 * this.rows.length : 0;\n  var newTarget = this.rows[0] > this.target ? this.rows[0] + this.rows.length : this.rows[0];\n  var newRows = [];\n  var rowsLen = this.rows.length + mod;\n\n  for (var i = mod; i < rowsLen; i += 1) {\n    newRows.push(this.target + i);\n  }\n\n  manualRowMove.moveRows(newRows.slice(), newTarget);\n  instance.render();\n  instance.selectCell(this.rows[0], 0, this.rows[this.rows.length - 1], instance.countCols() - 1, false, false);\n};\n\nUndoRedo.RowMoveAction.prototype.redo = function (instance, redoneCallback) {\n  var manualRowMove = instance.getPlugin('manualRowMove');\n  instance.addHookOnce('afterRender', redoneCallback);\n  manualRowMove.moveRows(this.rows.slice(), this.target);\n  instance.render();\n  var startSelection = this.rows[0] < this.target ? this.target - this.rows.length : this.target;\n  instance.selectCell(startSelection, 0, startSelection + this.rows.length - 1, instance.countCols() - 1, false, false);\n};\n\nfunction init() {\n  var instance = this;\n  var pluginEnabled = typeof instance.getSettings().undo === 'undefined' || instance.getSettings().undo;\n\n  if (pluginEnabled) {\n    if (!instance.undoRedo) {\n      /**\n       * Instance of Handsontable.UndoRedo Plugin {@link Handsontable.UndoRedo}\n       *\n       * @alias undoRedo\n       * @memberof! Handsontable.Core#\n       * @type {UndoRedo}\n       */\n      instance.undoRedo = new UndoRedo(instance);\n      exposeUndoRedoMethods(instance);\n      instance.addHook('beforeKeyDown', onBeforeKeyDown);\n      instance.addHook('afterChange', onAfterChange);\n    }\n  } else if (instance.undoRedo) {\n    delete instance.undoRedo;\n    removeExposedUndoRedoMethods(instance);\n    instance.removeHook('beforeKeyDown', onBeforeKeyDown);\n    instance.removeHook('afterChange', onAfterChange);\n  }\n}\n\nfunction onBeforeKeyDown(event) {\n  if (isImmediatePropagationStopped(event)) {\n    return;\n  }\n\n  var instance = this;\n  var editor = instance.getActiveEditor();\n\n  if (editor && editor.isOpened()) {\n    return;\n  }\n\n  var altKey = event.altKey,\n      ctrlKey = event.ctrlKey,\n      keyCode = event.keyCode,\n      metaKey = event.metaKey,\n      shiftKey = event.shiftKey;\n  var isCtrlDown = (ctrlKey || metaKey) && !altKey;\n\n  if (!isCtrlDown) {\n    return;\n  }\n\n  var isRedoHotkey = keyCode === 89 || shiftKey && keyCode === 90;\n\n  if (isRedoHotkey) {\n    // CTRL + Y or CTRL + SHIFT + Z\n    instance.undoRedo.redo();\n    stopImmediatePropagation(event);\n  } else if (keyCode === 90) {\n    // CTRL + Z\n    instance.undoRedo.undo();\n    stopImmediatePropagation(event);\n  }\n}\n\nfunction onAfterChange(changes, source) {\n  var instance = this;\n\n  if (source === 'loadData') {\n    return instance.undoRedo.clear();\n  }\n}\n\nfunction exposeUndoRedoMethods(instance) {\n  /**\n   * {@link UndoRedo#undo}\n   * @alias undo\n   * @memberof! Handsontable.Core#\n   */\n  instance.undo = function () {\n    return instance.undoRedo.undo();\n  };\n  /**\n   * {@link UndoRedo#redo}\n   * @alias redo\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.redo = function () {\n    return instance.undoRedo.redo();\n  };\n  /**\n   * {@link UndoRedo#isUndoAvailable}\n   * @alias isUndoAvailable\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.isUndoAvailable = function () {\n    return instance.undoRedo.isUndoAvailable();\n  };\n  /**\n   * {@link UndoRedo#isRedoAvailable}\n   * @alias isRedoAvailable\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.isRedoAvailable = function () {\n    return instance.undoRedo.isRedoAvailable();\n  };\n  /**\n   * {@link UndoRedo#clear}\n   * @alias clearUndo\n   * @memberof! Handsontable.Core#\n   */\n\n\n  instance.clearUndo = function () {\n    return instance.undoRedo.clear();\n  };\n}\n\nfunction removeExposedUndoRedoMethods(instance) {\n  delete instance.undo;\n  delete instance.redo;\n  delete instance.isUndoAvailable;\n  delete instance.isRedoAvailable;\n  delete instance.clearUndo;\n}\n\nvar hook = Hooks.getSingleton();\nhook.add('afterInit', init);\nhook.add('afterUpdateSettings', init);\nhook.register('beforeUndo');\nhook.register('afterUndo');\nhook.register('beforeRedo');\nhook.register('afterRedo');\nexport default UndoRedo;"]},"metadata":{},"sourceType":"module"}